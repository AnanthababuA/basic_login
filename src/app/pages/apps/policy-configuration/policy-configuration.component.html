<mat-card class="  cardWithShadow" style="min-height: 80vh;">

    <mat-nav-list class="p-x-16" >

        <button mat-flat-button  class="rounded m-b-8 bg-light-primary" style="padding: 1.3rem 1rem; margin: 0 10px;" [class.border-red]="formNo === 0" (click)="AddPolicy(0, 'Summary', 'ADMIN')"> <span class="text-primary" >Summary</span></button>


        <!-- 11111111111111111111111111111111111111111111111111111111111111111111111111111  -->

        <button mat-flat-button  class="rounded m-b-8 bg-light-accent" style="padding: 1.3rem 1rem; margin: 0 10px;" [class.border-red]="formNo === 1" (click)="AddPolicy(1, 'URL', 'ADMIN')" > <span class="text-accent" >Add URL</span></button>


        <!-- 22222222222222222222 -->

        <button mat-flat-button  class="rounded m-b-8 bg-light-success" style="padding: 1.3rem 1rem; margin: 0 10px;" [class.border-red]="formNo === 2" (click)="AddPolicy(2, 'IP', 'ADMIN')"> <span class="text-success" >Add IP</span></button>


        <!-- 33333333333333333333333333  -->

        <button mat-flat-button  class="rounded m-b-8 bg-light-error" style="padding: 1.3rem 1rem; margin: 0 10px;" [class.border-red]="formNo === 3" (click)="AddPolicy(3, 'BulkUpload', 'ADMIN')"> <span class="text-error" >Bulk Upload</span></button>

        <!-- 44444444444444444444444444444444  -->

        <button mat-flat-button  class="rounded m-b-8 bg-light-warning" style="padding: 1.3rem 1rem; margin: 0 10px;" [class.border-red]="formNo === 4" (click)="AddPolicy(4, 'policyUpdate', 'ADMIN')"> <span class="text-warning" >Policy Update</span></button>

        <button mat-flat-button  class="rounded m-b-8 bg-light-primary" style="padding: 1.3rem 1rem; margin: 0 10px;" [class.border-red]="formNo === 5" (click)="AddPolicy(5, 'policyVersion', 'ADMIN')"> <span class="text-primary" >Policy Version</span></button>

        <button mat-flat-button  class="rounded m-b-8 bg-light-accent" style="padding: 1.3rem 1rem; margin: 0 10px;" [class.border-red]="formNo === 6" (click)="AddPolicy(6, 'patchVersion', 'ADMIN')"> <span class="text-accent" >Patch Version</span></button>



    </mat-nav-list>


    <!-- <h1>hhhhhhh</h1> -->

    <mat-card-content class="p-24 bg-white">
        <div class="" >

            <div *ngIf="formNo ==0">


                <mat-card class="cardWithShadow">
                    <mat-card-header class="d-flex">
                        <mat-card-title>Summary</mat-card-title>
                    </mat-card-header>
                    <mat-card-content>


                        <div class="table-responsive m-t-30">
                            <table class="w-100">
                                <thead>
                                    <tr>
                                        <th class="f-w-600 mat-subtitle-1 f-s-14 p-l-0"
                                            style="border-bottom: 1px solid #ddd;">Policy type</th>
                                        <th class="f-w-600 mat-subtitle-1 f-s-14"
                                            style="border-bottom: 1px solid #ddd;">Total policy</th>
                                        <th class="f-w-600 mat-subtitle-1 f-s-14"
                                            style="border-bottom: 1px solid #ddd;">Active policy</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="p-l-0 d-flex justify-content-center"
                                            style="border-bottom: 1px solid #ddd;">
                                            <div class="d-flex align-items-center">
                                                <div class="m-l-16">
                                                    <h6 class="mat-subtitle-1 f-s-14 f-w-600">IP</h6>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="mat-body-1 text-center" style="border-bottom: 1px solid #ddd;">
                                            <span>{{policySummary?.IP.total}}</span>
                                        </td>
                                        <td class="mat-body-1 text-center" style="border-bottom: 1px solid #ddd;">
                                            <span>{{policySummary?.IP.addlist}}</span>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="p-l-0 d-flex justify-content-center"
                                            style="border-bottom: 1px solid #ddd;">
                                            <div class="d-flex align-items-center">
                                                <div class="m-l-16">
                                                    <h6 class="mat-subtitle-1 f-s-14 f-w-600">URL</h6>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="mat-body-1 text-center" style="border-bottom: 1px solid #ddd;">
                                            {{policySummary?.URL.total}}
                                        </td>
                                        <td class="mat-body-1 text-center" style="border-bottom: 1px solid #ddd;">
                                            <span>{{policySummary?.URL.addlist}}</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>


                    </mat-card-content>
                </mat-card>

            </div>

            <div *ngIf="formNo ==1">


                <div class="d-flex">
                    <div><strong>Policy Author:&nbsp;&nbsp;&nbsp;</strong> </div>
                    <div>{{userName}}</div>
                </div>

                <div class="row m-t-20">


                    <div class="col-lg-6">

                        <form [formGroup]="urlForm">

                            <mat-label class="mat-subtitle-2 f-s-14 f-w-600 m-b-12 d-block">URL</mat-label>

                            <mat-form-field appearance="outline" class="w-100" color="primary">
                                <input matInput formControlName="url" placeholder="Enter URL" />
                                <mat-icon matPrefix>
                                    <i-tabler name="chart-donut-3" class="icon-20 d-flex"></i-tabler>
                                </mat-icon>
                                <mat-error
                                    *ngIf="urlForm.get('url')?.hasError('pattern') && urlForm.get('url')?.invalid">
                                    Enter valid url
                                </mat-error>

                            </mat-form-field>
                            <button mat-flat-button color="primary" class="w-100" type="button" (click)="addUrl()"
                                style="max-width: fit-content;">
                                Add URL
                            </button>

                        </form>



                    </div>

                    <div class="col-lg-6">

                        <div
                            style="border-radius: 2rem; box-shadow: 0px 0px 5px 2px rgba(0, 0, 0, 0.2); padding-top: 12px;">



                            <div style=" min-height: 300px;">

                                <div *ngIf="addedUrls.length > 0" style="max-height: 500px; overflow: auto;">

                                    <mat-card-content>
                                        <div class="table-responsive m-t-30">
                                            <table mat-table [dataSource]="dataSource" class="w-100">

                                                <ng-container matColumnDef="serialNumber">
                                                    <th mat-header-cell *matHeaderCellDef
                                                        class="f-w-600 mat-subtitle-1 f-s-14">
                                                        Sr. No.
                                                    </th>
                                                    <td mat-cell *matCellDef="let i = index" class="mat-body-1">
                                                        {{ i + 1 }}
                                                    </td>
                                                </ng-container>

                                                <!-- URL Column -->
                                                <ng-container matColumnDef="URL">
                                                    <th mat-header-cell *matHeaderCellDef
                                                        class="f-w-600 mat-subtitle-1 f-s-14">
                                                        URL
                                                    </th>
                                                    <td mat-cell *matCellDef="let url" class="mat-body-1">
                                                        {{ url }}
                                                    </td>
                                                </ng-container>

                                                <!-- Button Column -->
                                                <ng-container matColumnDef="action">
                                                    <th mat-header-cell *matHeaderCellDef
                                                        class="f-w-600 mat-subtitle-1 f-s-14">
                                                        Action
                                                    </th>
                                                    <td mat-cell *matCellDef="let url" class="mat-body-1">
                                                        <button mat-flat-button color="warn" type="button"
                                                            (click)="deleteUrl(url)">Delete</button>
                                                    </td>
                                                </ng-container>

                                                <!-- Header and Row Definitions -->
                                                <tr mat-header-row *matHeaderRowDef="displayedColumns1"></tr>
                                                <tr mat-row
                                                    *matRowDef="let row; columns: ['serialNumber', 'URL', 'action']">
                                                </tr>
                                                <!-- <tr mat-row *matRowDef="let url; columns: displayedColumns1"></tr> -->
                                            </table>
                                        </div>
                                    </mat-card-content>

                                </div>

                                <div *ngIf="addedUrls.length ===0">
                                    <h2 style="margin-left: 20px;">Please add URL</h2>

                                </div>

                            </div>
                            <div style="display: flex; justify-content: center; padding-bottom: 15px;">
                                <button mat-flat-button color="accent" type="button" (click)="submitUrls()"
                                    [disabled]="addedUrls.length === 0">Submit URLs</button>
                            </div>
                        </div>
                    </div>
                </div>



            </div>

            <div *ngIf="formNo ==2">


                <div class="d-flex">
                    <div><strong>Policy Author:&nbsp;&nbsp;&nbsp;</strong> </div>
                    <div>{{userName}}</div>
                </div>

                <!-- new form from the url  -->
                <!-- IP Address Section -->
                <div class="row m-t-20">
                    <div class="col-lg-6">
                        <form [formGroup]="ipForm">
                            <mat-label class="mat-subtitle-2 f-s-14 f-w-600 m-b-12 d-block">IP Address</mat-label>
                            <mat-form-field appearance="outline" class="w-100" color="primary">
                                <input matInput formControlName="ip" placeholder="Enter IP Address" />
                                <mat-error *ngIf="ipForm.get('ip')?.hasError('pattern') && ipForm.get('ip')?.invalid">
                                    Enter a valid IP address
                                </mat-error>
                            </mat-form-field>
                            <button mat-flat-button color="primary" class="w-100" type="button" (click)="addIP()"
                                style="max-width: fit-content;">
                                Add IP
                            </button>
                        </form>
                    </div>

                    <!-- Display Section for Added IPs -->
                    <div class="col-lg-6">
                        <div
                            style="border-radius: 2rem; box-shadow: 0px 0px 5px 2px rgba(0, 0, 0, 0.2); padding-top: 12px;">
                            <div style="min-height: 300px;">
                                <div *ngIf="addedIPs.length > 0" style="max-height: 500px; overflow: auto;">
                                    <mat-card-content>
                                        <div class="table-responsive m-t-30">
                                            <table mat-table [dataSource]="ipDataSource" class="w-100">

                                                <!-- Serial Number Column -->
                                                <ng-container matColumnDef="serialNumber">
                                                    <th mat-header-cell *matHeaderCellDef
                                                        class="f-w-600 mat-subtitle-1 f-s-14">Sr. No.</th>
                                                    <td mat-cell *matCellDef="let i = index" class="mat-body-1">{{ i + 1
                                                        }}</td>
                                                </ng-container>

                                                <!-- IP Address Column -->
                                                <ng-container matColumnDef="IP">
                                                    <th mat-header-cell *matHeaderCellDef
                                                        class="f-w-600 mat-subtitle-1 f-s-14">IP Address</th>
                                                    <td mat-cell *matCellDef="let ip" class="mat-body-1">{{ ip }}</td>
                                                </ng-container>

                                                <!-- Button Column -->
                                                <ng-container matColumnDef="action">
                                                    <th mat-header-cell *matHeaderCellDef
                                                        class="f-w-600 mat-subtitle-1 f-s-14">Action</th>
                                                    <td mat-cell *matCellDef="let ip" class="mat-body-1">
                                                        <button mat-flat-button color="warn" type="button"
                                                            (click)="deleteIP(ip)">Delete</button>
                                                    </td>
                                                </ng-container>

                                                <!-- Header and Row Definitions -->
                                                <tr mat-header-row *matHeaderRowDef="displayedColumns2"></tr>
                                                <tr mat-row
                                                    *matRowDef="let row; columns: ['serialNumber', 'IP', 'action']">
                                                </tr>
                                            </table>
                                        </div>
                                    </mat-card-content>
                                </div>

                                <div *ngIf="addedIPs.length === 0">
                                    <h2 style="margin-left: 20px;">Please add IP Address</h2>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: center; padding-bottom: 15px;">
                                <button mat-flat-button color="accent" type="button" (click)="submitIPs()"
                                    [disabled]="addedIPs.length === 0">Submit IPs</button>
                            </div>
                        </div>
                    </div>
                </div>




            </div>

            <div *ngIf="formNo ==3">


                <div class="row">
                    <div class="col-lg-6 col-sm-8">
                        <mat-card class="b-1 shadow-none">
                            <mat-card-header>
                                <mat-card-title><strong>Bulk Upload Policies</strong></mat-card-title>
                            </mat-card-header>
                            <mat-card-content class="b-t-1">

                                <p> *Upload only .csv file with policy type and value.</p>

                                <input type="file" class="file-upload" accept=".csv" (change)="uploadPolicy($event)"
                                    id="fileInput">
                                <label for="fileInput" class="custom-label">Choose a CSV file</label>
                            </mat-card-content>
                        </mat-card>
                    </div>

                </div>


            </div>

            <div *ngIf="formNo ==4">

                <app-policy-update></app-policy-update>
            </div>

            <div *ngIf="formNo ==5">
                <h1 style="display: flex; justify-content: center;">Server Policy Version : {{serverPolicyVersion?.policy_version}}</h1> 
                <h1 style="display: flex; justify-content: center;">Updated On : {{serverPolicyVersion?.created_on | date:'dd-MM-yyyy HH:mm:ss' }}</h1> 
            </div>

            <div *ngIf="formNo ==6">
                <h1 style="display: flex; justify-content: center;">Server Patch Id : {{serverPatchVersion?.patchid}}</h1> 
                <h1 style="display: flex; justify-content: center;">Updated On : {{serverPatchVersion?.updated_on | date:'dd-MM-yyyy HH:mm:ss'}}</h1> 
            </div>

        </div>
    </mat-card-content>


</mat-card>



<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="ball-clip-rotate" [fullScreen]="true">
    <p class="text-white"> {{ loaderStatus }} </p>
</ngx-spinner>